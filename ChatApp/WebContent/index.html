<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular-csp.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="resources/js/jquery-1.11.0.js" ></script>
<title>Insert title here</title>
</head>
<body>
<h1>cao ja sam chat</h1>
<h1>pozz</h1>
<form action="rest/userChatController/registerUser" method="POST">
<input type="text" name="username">
<input type="text" name="password">
<input type="text" name="passwordRepeat">
<input type="submit">
</form>

<form action="rest/userChatController/loginUser" method="POST">
<input type="text" name="username">
<input type="text" name="password">
<input type="submit" >
</form>
<h1>JavaScript web socket demo</h1>
<div id="container">
	<label>Enter text:</label><input type="text" id="text"/>
	<input type="button" id="send" value="send" />
	
	<p></p>
	
	<div id="chatLog" ></div>

</div>
<script>
$(document).ready(function() {
	  var socket;
      function send(){
          var text = $('#text').val();

          if(text==""){
              message('<p>Please enter a message');
              return ;
          }
          try{
              socket.send(text);
              message('<p>Sent: '+text);
          } catch(exception){
             message('<p>Error: ' + exception);
          }
      }

      function message(msg){
      	console.log(msg);
        $('#chatLog').append(msg+'</p>');
      }

      $('#text').keypress(function(event) {
          if (event.keyCode == '13') {
            send();
          }
      });	

      $('#send').click(function(){
         send();
      });

      if(!("WebSocket" in window)){
	  	$('#chatLog, input, button, #examples').fadeOut("fast");
	  	$('<p>Oh no, you need a browser that supports WebSockets. How about <a href="http://www.google.com/chrome">Google/a>?</p>').appendTo('#container');
	  } else {
          var host = "ws://localhost:8080/ChatApp/websocket";
          try{
              socket = new WebSocket(host);
              message('<p>connect: Socket Status: '+socket.readyState);

              socket.onopen = function(){
             	 message('<p>onopen: Socket Status: '+socket.readyState+' (open)');
              }

              socket.onmessage = function(msg){
             	 message('<p>onmessage: Received: '+msg.data);
              }

              socket.onclose = function(){
              	message('<p>onclose: Socket Status: '+socket.readyState+' (Closed)');
              	socket = null;
              }			

          } catch(exception){
             message('<p>Error'+exception);
          }

	  }//End else

	});
</script>
</body>
</html>